---
title: 网易云音乐客户端逆向分析（1）
date: 2017-07-19 10:06:04
tags: [reverse,macOS]
categories: ["逆向研究"]
---

## 获取WebApp内容
进入``NeteaseMusic.app/Contents``目录观察，早就听闻网易云音乐客户端是个Hybird App，那想必``Resources``目录一定有相应的Web代码资源，ls后观察，在一堆图片文件里有个**resources.pack**文件很显眼：

<!--more-->

![](/images/15004438246350.jpg)

查看下文件类型：

````shell
file resources.pack
````

zip压缩文件！尝试解压：

```shell
unzip resources.pack
```

需要输入密码😭。。。
![](/images/15004311155914.jpg)

启动Hopper，打开网易云的可执行文件，稍等分析完毕之后，尝试搜索**unzip**关键字，毕竟他得先解压嘛

![](/images/15004311249604.jpg)

发现有个YYYWebfilesManager的类很可疑，尤其是看到它的伪码的时候：

![](/images/15004311460633.jpg)

启动cycript，挂到运行着的NeteaseMusic进程上，直接调一下这几个方法：

![](/images/15004311612498.jpg)

很High，现在文件已经解压出来了，只需要把它们从内存保存到硬盘既可。class-dump一下，看一眼``ZipArchive``的Api：

```shell
class-dump NeteaseMusic -H -o headers

cat headers/ZipArchive.h
```

内容如下

```objc
//
//     Generated by class-dump 3.5 (64 bit).
//
//     class-dump is Copyright (C) 1997-1998, 2000-2001, 2004-2013 by Steve Nygard.
//

#import "NSObject.h"

@class NSArray, NSFileManager, NSString;

@interface ZipArchive : NSObject
{
    void *_zipFile;
    void *_unzFile;
    unsigned long long _numFiles;
    NSString *_password;
    id _delegate;
    CDUnknownBlockType _progressBlock;
    NSArray *_unzippedFiles;
    NSFileManager *_fileManager;
    unsigned long long _stringEncoding;
}

@property(nonatomic) unsigned long long stringEncoding; // @synthesize stringEncoding=_stringEncoding;
@property(copy, nonatomic) CDUnknownBlockType progressBlock; // @synthesize progressBlock=_progressBlock;
@property(readonly, nonatomic) NSArray *unzippedFiles; // @synthesize unzippedFiles=_unzippedFiles;
@property(copy, nonatomic) NSString *password; // @synthesize password=_password;
@property(readonly, nonatomic) unsigned long long numFiles; // @synthesize numFiles=_numFiles;
@property(retain, nonatomic) id <ZipArchiveDelegate> delegate; // @synthesize delegate=_delegate;
- (id)Date1980;
- (BOOL)OverWrite:(id)arg1;
- (void)OutputErrorMessage:(id)arg1;
- (id)getZipFileContents;
- (BOOL)UnzipCloseFile;
- (id)UnzipFileToMemory;
- (BOOL)UnzipFileTo:(id)arg1 overWrite:(BOOL)arg2;
- (BOOL)UnzipOpenFile:(id)arg1 Password:(id)arg2;
- (BOOL)UnzipOpenFile:(id)arg1;
- (BOOL)CloseZipFile2;
- (BOOL)addFileToZip:(id)arg1 newname:(id)arg2;
- (BOOL)CreateZipFile2:(id)arg1 Password:(id)arg2;
- (BOOL)CreateZipFile2:(id)arg1;
- (void)dealloc;
- (id)initWithFileManager:(id)arg1;
- (id)init;

@end
```

注意到``- (BOOL)UnzipFileTo:(id)arg1 overWrite:(BOOL)arg2;``这个Api，直接在cycript环境中输入：

``` objc
[manager UnzipFileTo:@"/Users/kevin/Developer/Reverse/NeteaseMusic" overWrite: YES]
```

OK，此刻webfiles已经乖乖地躺在硬盘里了~
![](/images/15004311896870.jpg)

